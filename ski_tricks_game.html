<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Tricks - Halfpipe Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 100%);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameContainer {
            position: relative;
            width: 900px;
            height: 700px;
            background: linear-gradient(to bottom, #0f3460 0%, #533483 100%);
            border: 4px solid #FFD700;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
        }

        #gameCanvas {
            display: block;
        }

        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 10;
        }

        #score {
            font-size: 32px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }

        #combo {
            font-size: 28px;
            color: #FF6B6B;
            margin-bottom: 8px;
        }

        #timer {
            font-size: 24px;
            color: #4ECDC4;
        }

        #multiplier {
            font-size: 20px;
            color: #95E1D3;
            margin-top: 5px;
        }

        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
        }

        #startScreen h1, #gameOverScreen h1 {
            font-size: 56px;
            margin-bottom: 20px;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        }

        #startScreen p, #gameOverScreen p {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
            max-width: 700px;
            line-height: 1.6;
        }

        .controls {
            margin: 20px 0;
            padding: 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .controls h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .controls p {
            margin: 8px 0;
            font-size: 16px;
        }

        .trick-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .trick-item {
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 5px;
            font-size: 14px;
        }

        button {
            padding: 18px 50px;
            font-size: 28px;
            background: linear-gradient(to bottom, #FFD700, #FFA500);
            color: #1a1a2e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 6px 12px rgba(255, 215, 0, 0.4);
            transition: transform 0.1s;
            font-weight: bold;
        }

        button:hover {
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        #finalScore {
            font-size: 48px;
            color: #FFD700;
            margin: 20px 0;
        }

        .hidden {
            display: none !important;
        }

        #trickDisplay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s;
        }

        #trickName {
            font-size: 52px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.9);
            margin-bottom: 10px;
        }

        #trickPoints {
            font-size: 36px;
            color: #4ECDC4;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.9);
        }

        #currentTricks {
            position: absolute;
            right: 20px;
            top: 150px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            min-width: 200px;
        }

        #currentTricks h3 {
            color: #FFD700;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .trick-line {
            color: #4ECDC4;
            font-size: 14px;
            margin: 5px 0;
        }

        #airTimeBar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 25px;
            background: rgba(0,0,0,0.6);
            border: 2px solid #FFD700;
            border-radius: 15px;
            overflow: hidden;
        }

        #airTimeFill {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4ECDC4, #95E1D3);
            transition: width 0.1s;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="900" height="700"></canvas>
        
        <div id="ui">
            <div id="score">SCORE: 0</div>
            <div id="combo">COMBO: x1</div>
            <div id="timer">TIME: 60s</div>
            <div id="multiplier">Height Bonus: x1.0</div>
        </div>

        <div id="currentTricks">
            <h3>CURRENT RUN</h3>
            <div id="tricksList"></div>
        </div>

        <div id="trickDisplay">
            <div id="trickName"></div>
            <div id="trickPoints"></div>
        </div>

        <div id="airTimeBar">
            <div id="airTimeFill"></div>
        </div>

        <div id="startScreen">
            <h1>üéø SKI TRICKS üéø</h1>
            <p>Master the halfpipe! Perform tricks to rack up massive scores!</p>
            <div class="controls">
                <h3>CONTROLS</h3>
                <p><strong>‚Üê ‚Üí</strong> - Move left/right on halfpipe</p>
                <p><strong>SPACE</strong> - Launch from edge</p>
                <p><strong>‚Üë ‚Üì</strong> - Flip tricks (in air)</p>
                <p><strong>‚Üê ‚Üí</strong> - Spin tricks (in air)</p>
                
                <h3 style="margin-top: 20px;">GRAB TRICKS (in air)</h3>
                <div class="trick-list">
                    <div class="trick-item"><strong>Q</strong> - Mute Grab (100pts)</div>
                    <div class="trick-item"><strong>W</strong> - Indy Grab (100pts)</div>
                    <div class="trick-item"><strong>E</strong> - Method (150pts)</div>
                    <div class="trick-item"><strong>A</strong> - Stalefish (150pts)</div>
                    <div class="trick-item"><strong>S</strong> - Japan Air (200pts)</div>
                    <div class="trick-item"><strong>D</strong> - Tail Grab (100pts)</div>
                </div>
                
                <p style="margin-top: 15px;"><strong>TIP:</strong> Build speed, get huge air, and chain tricks for combo multipliers!</p>
                <p><strong>BIGGER JUMPS = MORE POINTS!</strong></p>
            </div>
            <button id="startButton">SHRED IT!</button>
        </div>

        <div id="gameOverScreen" class="hidden">
            <h1>TIME'S UP!</h1>
            <div id="finalScore">SCORE: 0</div>
            <p id="bestTrick"></p>
            <p id="longestCombo"></p>
            <button id="restartButton">GO AGAIN</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        const game = {
            running: false,
            score: 0,
            timeLeft: 60,
            combo: 1,
            currentRun: [],
            runScore: 0,
            bestRun: 0,
            longestCombo: 0,
            lastFrameTime: 0
        };

        // Player
        const player = {
            x: canvas.width / 2,
            y: 500,
            vx: 0,
            vy: 0,
            rotation: 0,
            rotationSpeed: 0,
            onGround: false,
            inAir: false,
            airTime: 0,
            maxAirTime: 0,
            side: 0, // -1 left, 1 right, 0 middle
            speed: 0,
            maxSpeed: 12
        };

        // Halfpipe
        const halfpipe = {
            leftX: 100,
            rightX: 800,
            bottomY: 500,
            topY: 650,
            width: 700
        };

        // Tricks
        const trickPoints = {
            // Grabs
            'MUTE': 100,
            'INDY': 100,
            'METHOD': 150,
            'STALEFISH': 150,
            'JAPAN AIR': 200,
            'TAIL GRAB': 100,
            // Flips
            'BACKFLIP': 200,
            'FRONTFLIP': 200,
            'DOUBLE BACKFLIP': 500,
            'DOUBLE FRONTFLIP': 500,
            // Spins
            '180': 50,
            '360': 150,
            '540': 250,
            '720': 400,
            '900': 600,
            '1080': 800
        };

        let currentGrab = null;
        let totalRotation = 0;
        let flipRotation = 0;
        const particles = [];
        const snowflakes = [];

        // Initialize snowflakes
        for (let i = 0; i < 100; i++) {
            snowflakes.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 2 + 1,
                speed: Math.random() * 1 + 0.5
            });
        }

        // Input
        const keys = {};
        let spacePressed = false;

        document.addEventListener('keydown', (e) => {
            if (!keys[e.key]) {
                keys[e.key] = true;
                
                // Grab tricks (only in air)
                if (player.inAir && !currentGrab) {
                    if (e.key === 'q') currentGrab = 'MUTE';
                    else if (e.key === 'w') currentGrab = 'INDY';
                    else if (e.key === 'e') currentGrab = 'METHOD';
                    else if (e.key === 'a') currentGrab = 'STALEFISH';
                    else if (e.key === 's') currentGrab = 'JAPAN AIR';
                    else if (e.key === 'd') currentGrab = 'TAIL GRAB';
                    
                    if (currentGrab) {
                        addTrickToRun(currentGrab);
                    }
                }
                
                // Launch
                if (e.key === ' ' && !spacePressed && player.onGround && Math.abs(player.vx) > 2) {
                    spacePressed = true;
                    player.inAir = true;
                    player.onGround = false;
                    player.vy = -20 - Math.abs(player.vx) * 0.8; // More speed = higher jump
                    player.airTime = 0;
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
            if (e.key === ' ') spacePressed = false;
        });

        // Start game
        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('restartButton').addEventListener('click', startGame);

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            game.running = true;
            game.score = 0;
            game.timeLeft = 60;
            game.combo = 1;
            game.currentRun = [];
            game.runScore = 0;
            game.bestRun = 0;
            game.longestCombo = 0;
            
            player.x = canvas.width / 2;
            player.y = 500;
            player.vx = 0;
            player.vy = 0;
            player.rotation = 0;
            player.onGround = false;
            player.inAir = false;
            player.airTime = 0;
            
            currentGrab = null;
            totalRotation = 0;
            flipRotation = 0;
            particles.length = 0;
            
            game.lastFrameTime = Date.now();
            gameLoop();
        }

        function addTrickToRun(trick) {
            game.currentRun.push(trick);
            updateTricksList();
        }

        function updateTricksList() {
            const list = document.getElementById('tricksList');
            list.innerHTML = game.currentRun.map((trick, i) => 
                `<div class="trick-line">${i + 1}. ${trick}</div>`
            ).join('');
        }

        function landRun() {
            if (game.currentRun.length === 0) return;
            
            // Calculate run score
            let runScore = 0;
            game.currentRun.forEach(trick => {
                runScore += trickPoints[trick] || 0;
            });
            
            // Apply height multiplier
            const heightMultiplier = 1 + (player.maxAirTime / 100);
            runScore *= heightMultiplier;
            
            // Apply combo multiplier
            runScore *= game.combo;
            
            game.score += Math.floor(runScore);
            game.combo++;
            
            if (game.combo > game.longestCombo) {
                game.longestCombo = game.combo;
            }
            
            if (runScore > game.bestRun) {
                game.bestRun = runScore;
            }
            
            // Show tricks completed
            showTrickDisplay('LANDED!', `+${Math.floor(runScore)} pts`);
            
            // Landing particles
            for (let i = 0; i < 30; i++) {
                particles.push({
                    x: player.x,
                    y: player.y + 20,
                    vx: (Math.random() - 0.5) * 10,
                    vy: Math.random() * -8,
                    life: 40,
                    color: '#FFD700'
                });
            }
            
            // Reset run
            game.currentRun = [];
            currentGrab = null;
            totalRotation = 0;
            flipRotation = 0;
            player.maxAirTime = 0;
            updateTricksList();
        }

        function crashRun() {
            game.combo = 1;
            game.currentRun = [];
            currentGrab = null;
            totalRotation = 0;
            flipRotation = 0;
            player.maxAirTime = 0;
            updateTricksList();
            
            // Crash particles
            for (let i = 0; i < 40; i++) {
                particles.push({
                    x: player.x,
                    y: player.y,
                    vx: (Math.random() - 0.5) * 12,
                    vy: (Math.random() - 0.5) * 12,
                    life: 50,
                    color: '#FF6B6B'
                });
            }
        }

        function updatePlayer(dt) {
            // Movement on halfpipe
            if (player.onGround) {
                if (keys['ArrowLeft']) {
                    player.vx -= 0.5;
                } else if (keys['ArrowRight']) {
                    player.vx += 0.5;
                }
                
                // Friction
                player.vx *= 0.98;
                
                // Gravity pulls to center when on ground
                const centerX = canvas.width / 2;
                const distFromCenter = player.x - centerX;
                player.vx -= distFromCenter * 0.01;
                
                player.vx = Math.max(-player.maxSpeed, Math.min(player.maxSpeed, player.vx));
            }
            
            // Air controls
            if (player.inAir) {
                player.airTime++;
                if (player.airTime > player.maxAirTime) {
                    player.maxAirTime = player.airTime;
                }
                
                // Spins
                if (keys['ArrowLeft']) {
                    player.rotationSpeed -= 0.008;
                    totalRotation -= 0.008;
                } else if (keys['ArrowRight']) {
                    player.rotationSpeed += 0.008;
                    totalRotation += 0.008;
                }
                
                // Flips
                if (keys['ArrowUp']) {
                    flipRotation -= 0.01;
                } else if (keys['ArrowDown']) {
                    flipRotation += 0.01;
                }
                
                player.rotation += player.rotationSpeed;
                
                // Gravity
                player.vy += 0.6;
            }
            
            player.x += player.vx;
            player.y += player.vy;
            
            // Halfpipe physics
            const pipeRadius = halfpipe.width / 2;
            const centerX = canvas.width / 2;
            const pipeBottom = halfpipe.topY;
            
            const dx = player.x - centerX;
            const dy = player.y - pipeBottom;
            const dist = Math.sqrt(dx * dx + dy * dy);
            
            if (dist >= pipeRadius - 20 && player.y >= halfpipe.bottomY) {
                // On the halfpipe surface
                const angle = Math.atan2(dy, dx);
                player.x = centerX + Math.cos(angle) * (pipeRadius - 20);
                player.y = pipeBottom + Math.sin(angle) * (pipeRadius - 20);
                
                if (player.inAir) {
                    // Landing
                    const rotationDeg = Math.abs(totalRotation) * (180 / Math.PI);
                    const flipDeg = Math.abs(flipRotation) * (180 / Math.PI);
                    
                    // Check for successful landing (upright)
                    const totalRot = Math.abs(player.rotation) % (Math.PI * 2);
                    const isUpright = totalRot < 0.5 || totalRot > Math.PI * 2 - 0.5;
                    
                    if (isUpright) {
                        // Add spin tricks
                        if (rotationDeg >= 1080) addTrickToRun('1080');
                        else if (rotationDeg >= 900) addTrickToRun('900');
                        else if (rotationDeg >= 720) addTrickToRun('720');
                        else if (rotationDeg >= 540) addTrickToRun('540');
                        else if (rotationDeg >= 360) addTrickToRun('360');
                        else if (rotationDeg >= 180) addTrickToRun('180');
                        
                        // Add flip tricks
                        if (flipDeg >= 720) {
                            if (flipRotation > 0) addTrickToRun('DOUBLE BACKFLIP');
                            else addTrickToRun('DOUBLE FRONTFLIP');
                        } else if (flipDeg >= 360) {
                            if (flipRotation > 0) addTrickToRun('BACKFLIP');
                            else addTrickToRun('FRONTFLIP');
                        }
                        
                        landRun();
                    } else {
                        crashRun();
                    }
                    
                    player.inAir = false;
                    player.onGround = true;
                    player.airTime = 0;
                    player.rotation = 0;
                    player.rotationSpeed = 0;
                }
                
                player.onGround = true;
                player.vy = 0;
            } else {
                player.onGround = false;
            }
            
            // Keep in bounds
            if (player.x < 50) player.x = 50;
            if (player.x > canvas.width - 50) player.x = canvas.width - 50;
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].vx;
                particles[i].y += particles[i].vy;
                particles[i].vy += 0.3;
                particles[i].life--;
                
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        function updateSnowflakes() {
            for (let flake of snowflakes) {
                flake.y += flake.speed;
                flake.x += Math.sin(flake.y / 50) * 0.5;
                
                if (flake.y > canvas.height) {
                    flake.y = -10;
                    flake.x = Math.random() * canvas.width;
                }
            }
        }

        function showTrickDisplay(name, points) {
            document.getElementById('trickName').textContent = name;
            document.getElementById('trickPoints').textContent = points;
            document.getElementById('trickDisplay').style.opacity = '1';
            
            setTimeout(() => {
                document.getElementById('trickDisplay').style.opacity = '0';
            }, 1500);
        }

        function drawHalfpipe() {
            // Halfpipe
            ctx.strokeStyle = '#2C3E50';
            ctx.lineWidth = 8;
            ctx.beginPath();
            
            const centerX = canvas.width / 2;
            const radius = halfpipe.width / 2;
            
            for (let angle = 0; angle <= Math.PI; angle += 0.1) {
                const x = centerX + Math.cos(angle) * radius;
                const y = halfpipe.topY + Math.sin(angle) * radius;
                
                if (angle === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Pipe shading
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            for (let angle = 0; angle <= Math.PI; angle += 0.1) {
                const x = centerX + Math.cos(angle) * radius;
                const y = halfpipe.topY + Math.sin(angle) * radius;
                if (angle === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.lineTo(centerX + radius, canvas.height);
            ctx.lineTo(centerX - radius, canvas.height);
            ctx.closePath();
            ctx.fill();
        }

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.rotation + flipRotation);
            
            // Skis
            ctx.fillStyle = '#34495E';
            ctx.fillRect(-25, 15, 50, 6);
            
            // Body
            ctx.fillStyle = '#E74C3C';
            ctx.fillRect(-12, -25, 24, 45);
            
            // Head
            ctx.fillStyle = '#FFD1A3';
            ctx.beginPath();
            ctx.arc(0, -35, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // Helmet
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(0, -35, 12, Math.PI, 0);
            ctx.fill();
            
            // Grab indicator
            if (currentGrab) {
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(0, 0, 40, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            ctx.restore();
        }

        function drawParticles() {
            for (let p of particles) {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 50;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        function drawSnowflakes() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            for (let flake of snowflakes) {
                ctx.beginPath();
                ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function updateUI() {
            document.getElementById('score').textContent = `SCORE: ${Math.floor(game.score)}`;
            document.getElementById('combo').textContent = `COMBO: x${game.combo}`;
            document.getElementById('timer').textContent = `TIME: ${game.timeLeft}s`;
            
            const heightMult = 1 + (player.maxAirTime / 100);
            document.getElementById('multiplier').textContent = 
                `Height Bonus: x${heightMult.toFixed(1)}`;
            
            // Air time bar
            const airPercent = player.inAir ? (player.airTime / 120) * 100 : 0;
            document.getElementById('airTimeFill').style.width = `${Math.min(airPercent, 100)}%`;
        }

        function endGame() {
            game.running = false;
            document.getElementById('finalScore').textContent = `SCORE: ${Math.floor(game.score)}`;
            document.getElementById('bestTrick').textContent = 
                `Best Run: ${Math.floor(game.bestRun)} points`;
            document.getElementById('longestCombo').textContent = 
                `Longest Combo: x${game.longestCombo}`;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function gameLoop() {
            if (!game.running) return;
            
            const now = Date.now();
            const dt = (now - game.lastFrameTime) / 16.67; // Normalize to 60fps
            game.lastFrameTime = now;
            
            // Timer
            if (Math.floor(now / 1000) !== Math.floor((now - 16.67) / 1000)) {
                game.timeLeft--;
                if (game.timeLeft <= 0) {
                    endGame();
                    return;
                }
            }
            
            // Clear
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update
            updatePlayer(dt);
            updateParticles();
            updateSnowflakes();
            
            // Draw
            drawSnowflakes();
            drawHalfpipe();
            drawParticles();
            drawPlayer();
            updateUI();
            
            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>